<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <title>SmartHome and Security</title>
</head>
<body>
    <div class='w-100'>
            <nav class='navbar navbar-light bg-primary'>
                <div class='container-fluid'>
                    <span class='navbar-brand mb-0 h1 text-white p-2 fs-3'>SmartHome and Security</span>
                </div>
            </nav>
            <div class='d-flex justify-content-center shadow-lg m-3'>
                 <div class='w-100'>
                        <label class='p-3 fs-5 bg-primary bg-gradient rounded-top d-block text-white'>
                            Controls
                        </label>
                        
                    <div class='bd-example m-3'>
                        <label class='fs-3 p-2'>GPIO</label>
                        <br>
                        <div class='d-flex flex-column'>
                            <div class='row align-item-start p-2'>
                                <div class='col'><h4>D5<span class="badge rounded-pill bg-primary">etatGpio[0]</span></h4></div>
                                <div class='col'><form action='/' method='POST'><button type='button-submit' class='btn btn-success btn-lg' value='1' name='D5'>ON</button></form></div>
                                <div class='col'><form action='/' method='POST'><button type='button-submit' class='btn btn-danger btn-lg' value='0' name='D5'>OFF</button></form></div>
                            </div>
                            <div class='row align-item-start p-2'>
                                <div class='col'><h4>D6<span class="badge rounded-pill bg-primary">etatGpio[1]</span></h4></div>
                                <div class='col'><form action='/' method='POST'><button type='button-submit' class='btn btn-success btn-lg' value='1' name='D6'>ON</button></form></div>
                                <div class='col'><form action='/' method='POST'><button type='button-submit' class='btn btn-danger btn-lg' value='0' name='D6'>OFF</button></form></div>
                            </div>
                            <div class='row align-item-start p-2'>
                                <div class='col'><h4>D7<span class="badge rounded-pill bg-primary">etatGpio[2]</span></h4></div>
                                <div class='col'><form action='/' method='POST'><button type='button-submit' class='btn btn-success btn-lg' value='1' name='D7'>ON</button></form></div>
                                <div class='col'><form action='/' method='POST'><button type='button-submit' class='btn btn-danger btn-lg' value='0' name='D7'>OFF</button></form></div>
                            </div>
                            <div class='row align-item-start p-2'>
                                <div class='col'><h4>D8<span class="badge rounded-pill bg-primary">etatGpio[3]</span></h4></div>
                                <div class='col'><form action='/' method='POST'><button type='button-submit' class='btn btn-success btn-lg' value='1' name='D8'>ON</button></form></div>
                                <div class='col'><form action='/' method='POST'><button type='button-submit' class='btn btn-danger btn-lg' value='0' name='D8'>OFF</button></form></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class='d-flex justify-content-center shadow-lg m-3'>
                <div class='w-100'>
                    <label class='p-3 fs-5 bg-primary bg-gradient rounded-top d-block text-white'>
                        Security log
                    </label>
                    <div class="bd-example m-3">
                        <label class='fs-3 p-2'>Fingerprint Sensor log</label>
                        <button id='add' class='btn btn-dark'>Add</button>
                        <button id='clear' class='btn btn-danger' onclick='clearStorage()'>Delete all records</button>
                        <br>
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                  <th scope="col">#</th>
                                  <th scope="col">Date</th>
                                  <th scope="col">Time</th>
                                  <th scope="col">Status</th>
                                  <th scope="col">#ID</th>
                                </tr>
                              </thead>
                              <tbody class="sensorLogTable">

                              </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <script>
            add = document.getElementById("add");
            add.addEventListener("click", getAndUpdate);
            update();
            function getAndUpdate() {
                let time = new Date();
                let hour = time.getHours();
                let min = time.getMinutes();
                let sec = time.getSeconds();
                let date = time.getDate();
                let month = (time.getMonth() + 1);
                let year = time.getFullYear();
                am_pm = "AM";
                if (hour > 12) {
                    hour -= 12;
                    am_pm = "PM";
                }
                if (hour == 0) {
                    hr = 12;
                    am_pm = "AM";
                }
                hour = hour < 10 ? "0" + hour : hour;
                min = min < 10 ? "0" + min : min;
                sec = sec < 10 ? "0" + sec : sec;
                let currentTime = hour + ":" + min + ":" + sec + am_pm;
                let currentDate = date + "/" + month + "/" + year;
                status = "Pass"
                id = 1;
                if (localStorage.getItem('itemJson') == null) {
                    itemJsonArray = [];
                    itemJsonArray.push([currentDate, currentTime, status, id]);
                    localStorage.setItem('itemJson', JSON.stringify(itemJsonArray));
                }
                else {
                    itemJsonArrayStr = localStorage.getItem('itemsJson')
                    itemJsonArray = JSON.parse(itemJsonArrayStr);
                    itemJsonArray.push([currentDate, currentTime, status, id]);
                    localStorage.setItem('itemsJson', JSON.stringify(itemJsonArray))
                }
                update();
            }
            function update() {
                if (localStorage.getItem('itemsJson') == null) {
                    itemJsonArray = [];
                    localStorage.setItem('itemsJson', JSON.stringify(itemJsonArray))
                }
                else {
                    itemJsonArrayStr = localStorage.getItem('itemsJson')
                    itemJsonArray = JSON.parse(itemJsonArrayStr);
                }
                // Populate the table
                let tableBody = document.getElementById("sensorLogTable");
                let str = "";
                itemJsonArray.forEach((element, index) => {
                    str += `
                        <tr>
                        <th scope="row">${index + 1}</th>
                        <td>${element[0]}</td>
                        <td>${element[1]}</td>
                        <td>${element[2]}</td>
                        <td>${element[3]}</td>
                        <td><button class='btn btn-sm btn-primary' onclick='deleted(${index})'>Delete</button></td> 
                        </tr>`;
                });
                tableBody.innerHTML = str;
            }
            function deleted(itemIndex) {
                console.log("Delete", itemIndex);
                itemJsonArrayStr = localStorage.getItem('itemsJson')
                itemJsonArray = JSON.parse(itemJsonArrayStr);
                // Delete itemIndex element from the array
                itemJsonArray.splice(itemIndex, 1);
                localStorage.setItem('itemsJson', JSON.stringify(itemJsonArray));
                update();
            }
            function clearStorage() {
                if (confirm("Do you areally want to clear?")) {
                    console.log('Clearing the storage')
                    localStorage.clear();
                    update();
                }
            }
        </script>
</body>
</html>