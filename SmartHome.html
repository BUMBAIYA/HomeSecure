<html charset=UTF-8>
    <head>
        <meta http-equiv='refresh' content='60' name='viewport' content='width=device-width, initial-scale=1'/>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
        <title>Smarthome and security</title>
    </head>
    <body>
        <div class='w-100'>
            <nav class='navbar navbar-light bg-primary'>
                <div class='container-fluid'>
                    <span class='navbar-brand mb-0 h1 text-white p-2 fs-3'>SmartHome and Security</span>
                </div>
            </nav>
            <div class='d-flex justify-content-center shadow-lg m-3'>
                 <div class='w-100'>
                        <label class='p-3 fs-5 bg-primary bg-gradient rounded-top d-block text-white'>
                            Controls
                        </label>
                    <div class='bd-example m-3'>
                        <label class='fs-3 p-2'>GPIO</label>
                        <div class="card card-body">
                            <div class='d-flex flex-column'>
                                <div class='row align-item-start p-2'>
                                    <div class='col'><h4 id="h1" class='fw-bold'>D5</h4><span id="D5" class="badge rounded-pill bg-dark">OFF</span></div>
                                    <div class='col'><button class='btn btn-success btn-lg' onclick="send(1,5)">ON</button></div>
                                    <div class='col'><button class='btn btn-danger btn-lg' onclick="send(0,5)">OFF</button></div>
                                </div>
                                <br>
                                <div class='row align-item-start p-2'>
                                    <div class='col'><h4 id="h2" class='fw-bold'>D6</h4><span id="D6" class="badge rounded-pill bg-dark">OFF</span></div>
                                    <div class='col'><button class='btn btn-success btn-lg' onclick="send(1,6)">ON</button></div>
                                    <div class='col'><button class='btn btn-danger btn-lg' onclick="send(0,6)">OFF</button></div>
                                </div>
                                <br>
                                <div class='row align-item-start p-2'>
                                    <div class='col'><h4 id="h3" class='fw-bold'>D7</h4><span id="D7" class="badge rounded-pill bg-dark">OFF</span></div>
                                    <div class='col'><button class='btn btn-success btn-lg' onclick="send(1,7)">ON</button></div>
                                    <div class='col'><button class='btn btn-danger btn-lg' onclick="send(0,7)">OFF</button></div>
                                </div>
                                <br>
                                <div class='row align-item-start p-2'>
                                    <div class='col'><h4 id="h4" class='fw-bold'>D8</h4><span id="D8" class="badge rounded-pill bg-dark">OFF</span></div>
                                    <div class='col'><button class='btn btn-success btn-lg' onclick="send(1,8)">ON</button></div>
                                    <div class='col'><button class='btn btn-danger btn-lg' onclick="send(0,8)">OFF</button></div>
                                </div>
                                <br>
                                <div class="align-item-start p-2">
                                    <button class="btn btn-primary fs-7" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                                        Edit Appliance name
                                    </button>
                                    <div class="collapse mt-2" id="collapseExample">
                                        <div class="card card-body">
                                            <div class="input-group mb-3">
                                                <span class="input-group-text">Pin D5</span>
                                                <input type="text" class="form-control" placeholder="Appliance Nmae" id="app1">
                                            </div>
                                            <div class="input-group mb-3">
                                                <span class="input-group-text">Pin D6</span>
                                                <input type="text" class="form-control" placeholder="Appliance Nmae" id="app2">
                                            </div>
                                            <div class="input-group mb-3">
                                                <span class="input-group-text">Pin D7</span>
                                                <input type="text" class="form-control" placeholder="Appliance Nmae" id="app3">
                                            </div>
                                            <div class="input-group mb-3">
                                                <span class="input-group-text">Pin D8</span>
                                                <input type="text" class="form-control" placeholder="Appliance Nmae" id="app4">
                                            </div>
                                            <div class="col-auto">
                                                <button class="btn btn-primary" onclick="changeName()">Save</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class='d-flex justify-content-center shadow-lg m-3'>
                <div class='w-100'>
                    <label class='p-3 fs-5 bg-primary bg-gradient rounded-top d-block text-white'>
                        Security log
                    </label>
                    <div class='bd-example m-3'>
                        <label class='fs-3 p-2'>Fingerprint Sensor log</label>
                        <button id='add' class='btn btn-dark'>Add</button>
                        <br>
                        <table class='table table-hover'>
                            <thead>
                                <tr>
                                  <th scope='col'>#</th>
                                  <th scope='col'>Date</th>
                                  <th scope='col'>Time</th>
                                  <th scope='col'>Status</th>
                                  <th scope='col'>#ID</th>
                                  <th scope='col'>Command</th>
                                </tr>
                              </thead>
                              <tbody id='sensorLogTable'>
                              </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-center shadow-lg m-3">
                <div class="w-100">
                    <label class='p-3 fs-5 bg-primary bg-gradient rounded-top d-block text-white'>
                        Schedule Task
                    </label>
                    <div class="bd-example m-3">
                        <label class='fs-3 p-2 d-block'>Schedule task</label>
                        <label class='fs-7 p-2 text-danger'>*Note: task can only be scheduled for current day</label>
                        <div class="d-flex flex-column mt-3">
                            <div class="card  card-body">
                                <form class="row g-3">
                                    <div class="col-md-6 mt-2">
                                        <label class="form-label fw-bold">Choose Appliance</label>
                                        <select class="form-select" id="pinSelectChoice">
                                            <option value=0 id="c1">D5</option>
                                            <option value=1 id="c2">D6</option>
                                            <option value=2 id="c3">D7</option>
                                            <option value=3 id="c4">D8</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mt-2">
                                        <label class="form-label fw-bold">Choose State</label>
                                        <select name="" id="modeSelectChoice" class="form-select">
                                            <option value="OFF">OFF</option>
                                            <option value="ON">ON</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mt-3">
                                        <label class='form-label fw-bold'>Choose Time</label>
                                        <div class="card card-body">
                                            <div class="slidecontainer">
                                                <label>Choose Hour: <input type="range" class="form-range" id="hourRange" min="0" max="23"></label>
                                            </div>
                                            <div class="slidecontainer">
                                                <label for="">Choose Minute: <input type="range" class="form-range" id="minRange" min="0" max="59"></label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mt-3">
                                        <label class='form-label fw-bold'>Selected Time</label>
                                        <div class="card card-body">
                                            <ul class="list-inline">
                                                <li class="list-inline-item">Time:</li>
                                                <li id='dispHour' class="list-inline-item fw-bold">0</li>
                                                <li class="list-inline-item">:</li>
                                                <li id='dispMin' class="list-inline-item fw-bold">0</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="col-12 mt-3">
                                        <button type="button" class="btn btn-primary" id="submit">Submit</button>
                                    </div>
                                </form>
                            </div>
                            <div class="card card-body mt-3">
                                <h4>Schedule Log</h4>
                                <div class="row">
                                    <table class="table">
                                        <thead>
                                          <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">GPIO</th>
                                            <th scope="col">State</th>
                                            <th scope="col">Time</th>
                                            <th scope="col">Command</th>
                                          </tr>
                                        </thead>
                                        <tbody id="scheduleTable">
                                        </tbody>
                                      </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <script>
        let currentTime;
        let currentDate;
        var hourSlider = document.getElementById('hourRange');
        var hourDisp = document.getElementById('dispHour');
        hourDisp.innerHTML = hourSlider.value;

        hourSlider.oninput = function() {
            hourDisp.innerHTML = this.value;
        };

        var minSlider = document.getElementById('minRange');
        var minDisp = document.getElementById('dispMin');
        minDisp.innerHTML = minSlider.value;

        minSlider.oninput = function() {
            minDisp.innerHTML = this.value;
        };

        add = document.getElementById("add");
        add.addEventListener("click", getAndUpdate);
        add = document.getElementById("submit");
        add.addEventListener("click", submit);
        update();
        update1();
        changeNameChoices();
        function getTime() {
            let time = new Date();
            let hour = time.getHours();
            let min = time.getMinutes();
            let sec = time.getSeconds();
            let date = time.getDate();
            let month = (time.getMonth() + 1);
            let year = time.getFullYear();
            am_pm = "AM";
            if (hour > 12) {
                hour -= 12;
                am_pm = "PM";
            }
            if (hour == 0) {
                hr = 12;
                am_pm = "AM";
            }
            hour = hour < 10 ? "0" + hour : hour;
            min = min < 10 ? "0" + min : min;
            sec = sec < 10 ? "0" + sec : sec;
            currentTime = hour + ":" + min + ":" + sec + am_pm;
            currentDate = date + "/" + month + "/" + year;

        }
        function getAndUpdate() {
            getTime();
            status = "Pass";
            id = 1;

            if (localStorage.getItem('itemJson') == null) {
                itemJsonArray = [];
                itemJsonArray.push([currentDate, currentTime, status, id]);
                localStorage.setItem('itemJson', JSON.stringify(itemJsonArray));
            }
            else {
                itemJsonArrayStr = localStorage.getItem('itemsJson');
                itemJsonArray = JSON.parse(itemJsonArrayStr);
                itemJsonArray.push([currentDate, currentTime, status, id]);
                localStorage.setItem('itemsJson', JSON.stringify(itemJsonArray));
            }
            update();
        }
        function update() {
            if (localStorage.getItem('itemsJson') == null) {
                itemJsonArray = [];
                localStorage.setItem('itemsJson', JSON.stringify(itemJsonArray));
            }
            else {
                itemJsonArrayStr = localStorage.getItem('itemsJson');
                itemJsonArray = JSON.parse(itemJsonArrayStr);
            }
            let tableBody = document.getElementById("sensorLogTable");
            let str = "";
            itemJsonArray.forEach((element, index) => {
                str += `
                    <tr>
                    <th scope="row">${index + 1}</th>
                    <td>${element[0]}</td>
                    <td>${element[1]}</td>
                    <td>${element[2]}</td>
                    <td>${element[3]}</td>
                    <td><button class='btn btn-sm btn-danger' onclick='deleted(${index})'>Delete</button></td> 
                    </tr>`;
            });
            tableBody.innerHTML = str;
        }
        function deleted(itemIndex) {
            console.log("Delete", itemIndex);
            itemJsonArrayStr = localStorage.getItem('itemsJson');
            itemJsonArray = JSON.parse(itemJsonArrayStr);
            itemJsonArray.splice(itemIndex, 1);
            localStorage.setItem('itemsJson', JSON.stringify(itemJsonArray));
            update();
        }
        function submit() {
            getTime();
            var time =  document.getElementById('hourRange').value + ":" + document.getElementById('minRange').value;
            var pin = document.getElementById("pinSelectChoice").value;
            var temp = localStorage.getItem('AppName');
            var temp1 = JSON.parse(temp);
            var mode = document.getElementById("modeSelectChoice").value;

            if (localStorage.getItem('scheduleJson') == null) {
                itemJsonArray1 = [];
                itemJsonArray1.push([temp1[pin], mode, time]);
                localStorage.setItem('scheduleJson', JSON.stringify(itemJsonArray1));
            }
            else {
                itemJsonArrayStr1 = localStorage.getItem('scheduleJson');
                itemJsonArray1 = JSON.parse(itemJsonArrayStr1);
                itemJsonArray1.push([temp1[pin], mode, time]);
                localStorage.setItem('scheduleJson', JSON.stringify(itemJsonArray1));
            }
            update1();
        }
        function update1() {
            if (localStorage.getItem('scheduleJson') == null) {
                itemJsonArray1 = [];
                localStorage.setItem('scheduleJson', JSON.stringify(itemJsonArray1));
            }
            else {
                itemJsonArrayStr1 = localStorage.getItem('scheduleJson');
                itemJsonArray1 = JSON.parse(itemJsonArrayStr1);
            }
            let tableBody1 = document.getElementById("scheduleTable");
            let str1 = "";
            itemJsonArray1.forEach((element, index) => {
                str1 += `
                    <tr>
                    <th scope="row">${index + 1}</th>
                    <td>${element[0]}</td>
                    <td>${element[1]}</td>
                    <td>${element[2]}</td>
                    <td><button class='btn btn-sm btn-danger' onclick='deleted1(${index})'>Delete</button></td> 
                    </tr>`;
            });
            tableBody1.innerHTML = str1;
        }
        function deleted1(itemIndex) {
            console.log("Delete", itemIndex);
            itemJsonArrayStr1 = localStorage.getItem('scheduleJson');
            itemJsonArray1 = JSON.parse(itemJsonArrayStr1);
            itemJsonArray1.splice(itemIndex, 1);
            localStorage.setItem('scheduleJson', JSON.stringify(itemJsonArray1));
            update1();
        }
        function changeName() {
            var app1Name1 = document.getElementById("app1").value;
            var app1Name2 = document.getElementById("app2").value;
            var app1Name3 = document.getElementById("app3").value;
            var app1Name4 = document.getElementById("app4").value;
            if (app1Name1=="" || app1Name2=="" || app1Name3=="" || app1Name4=="") {
                console.log("check input");
            }
            else {
                appNameString = [app1Name1,app1Name2,app1Name3,app1Name4];
                localStorage.setItem('AppName',JSON.stringify(appNameString));
                console.log("Done saving the name to local storage!");
                changeNameChoices();
            }
        }
        function changeNameChoices() {
            var temp = localStorage.getItem('AppName');
            var temp1 = JSON.parse(temp);
            document.getElementById("h1").innerHTML = temp1[0];
            document.getElementById("h2").innerHTML = temp1[1];
            document.getElementById("h3").innerHTML = temp1[2];
            document.getElementById("h4").innerHTML = temp1[3];
            document.getElementById("c1").innerHTML = temp1[0];
            document.getElementById("c2").innerHTML = temp1[1];
            document.getElementById("c3").innerHTML = temp1[2];
            document.getElementById("c4").innerHTML = temp1[3];
        }
    </script>
    </body>
</html>
